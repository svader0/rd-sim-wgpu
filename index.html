<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gray-Scott Reaction-Diffusion</title>
    <link rel="stylesheet" href="https://unpkg.com/grapick/dist/grapick.min.css">
    <link rel="stylesheet" href="static/styles.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css"
    integrity="sha384-WcoG4HRXMzYzfCgiyfrySxx90XSl2rxY5mnVY5TwtWE6KLrArNKn0T/mOgNL0Mmi" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.js"
    integrity="sha384-J+9dG2KMoiR9hqcFao0IBLwxt6zpcyN68IgwzsCSkbreXUjmNVRhPFTssqdSGjwQ"
    crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/contrib/auto-render.min.js"
    integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

</head>
<body>
    <div class="canvas-wrapper">
        <canvas id="canvas" width="800" height="800"></canvas>
        <div id="map-labels" class="map-labels" style="display: none;"></div>
        <div class="info-overlay">
            <div id="fps-display">FPS: --</div>
            <a href="https://github.com/svader0/rd-sim-wgpu" target="_blank" rel="noopener noreferrer">
                <span>‚≠ê</span> GitHub
            </a>
        </div>
    </div>
    
    <div class="sidebar">
        <div class="tabs">
            <button class="tab active" data-tab="controls">Controls</button>
            <button class="tab" data-tab="about">About</button>
        </div>
        
        <div id="controls-tab" class="tab-content active">
        <h2>Presets</h2>
        <div class="control-group">
            <select id="preset">
                <option value="0.0545,0.062">Coral (F=0.055, k=0.062)</option>
                <option value="0.014,0.054">Bacteria (F=0.014, k=0.054)</option>
                <option value="0.0367,0.0649">Mitosis (F=0.0367, k=0.0649)</option>
                <option value="0.037,0.060">Fingerprint (F=0.037, k=0.060)</option>
                <option value="0.014,0.047">Spirals (F=0.014, k=0.047)</option>
                <option value="0.026,0.051">Unstable (F=0.026, k=0.051)</option>
                <option value="0.006,0.031">Waves (F=0.006, k=0.031)</option>
                <option value="0.078,0.061">Worms (F=0.078, k=0.061)</option>
                <option value="0.016,0.055">Zebrafish (F=0.016, k=0.055)</option>
                <option value="0.030,0.060">Solitons (F=0.030, k=0.060)</option>
                <option value="0.029,0.057">Maze (F=0.029, k=0.057)</option>
            </select> 
        </div>

        <div class="info">
            <strong>How to use:</strong><br>
            - Click and drag on the canvas to add reactants<br>
            - Choose presets to see different patterns<br>
            - Use WASD keys to pan, or mouse wheel to zoom<br>
        </div>

        <h2>Parameters</h2>
        <div class="control-group">
            <label>
                Feed Rate (\(F\)): <span class="value-display" id="feed-value">0.055</span>
            </label>
            <input type="range" id="feed" min="0" max="0.1" step="0.0001" value="0.055">
            <small class="param-hint">Rate at which chemical U is fed into the system</small>
        </div>

        <div class="control-group">
            <label>
                Kill Rate (\(k\)): <span class="value-display" id="kill-value">0.062</span>
            </label>
            <input type="range" id="kill" min="0" max="0.08" step="0.0001" value="0.062">
            <small class="param-hint">Rate at which chemical V is removed from the system</small>
        </div>

        <div class="control-group">
            <label>
                Diffusion U (\(D_U\)): <span class="value-display" id="du-value">1.0</span>
            </label>
            <input type="range" id="du" min="0.1" max="1.5" step="0.01" value="1.0">
            <small class="param-hint">How fast chemical U spreads across the surface</small>
        </div>

        <div class="control-group">
            <label>
                Diffusion V (\(D_V\)): <span class="value-display" id="dv-value">0.5</span>
            </label>
            <input type="range" id="dv" min="0.1" max="1.0" step="0.01" value="0.5">
            <small class="param-hint">How fast chemical V spreads across the surface</small>
        </div>

        <div class="control-group">
            <label>
                Speed (steps/frame): <span class="value-display" id="speed-value">8</span>
            </label>
            <input type="range" id="speed" min="1" max="32" step="1" value="8">
            <small class="param-hint">Number of simulation steps computed per frame</small>
        </div>

        <div class="control-group">
            <label>
                Noise Injection: <span class="value-display" id="noise-value">0.00</span>
            </label>
            <input type="range" id="noise" min="0" max="0.01" step="0.0001" value="0">
            <small class="param-hint">Applies random noise at each step</small>
        </div>

        <div class="control-group">
            <label>Boundary Condition</label>
            <select id="boundary">
                <option value="2">Reflect (Mirror)</option>
                <option value="1">Clamp (Fixed Edges)</option>
                <option value="0">Wrap (Toroidal)</option>
            </select>
            <small class="param-hint">How chemicals behave at the edges of the grid</small>
        </div>

        <div class="control-group">
            <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="map-mode" style="width: auto; height: auto;">
                <strong>Map Mode (F/k gradients)</strong>
                <small class="param-hint">Varies feed and kill rates across the grid to visualize effects of different k and F values</small>
            </label>
        </div>

        <h2>Visuals</h2>
        <div class="control-group">
            <label>Laplacian Stencil</label>
            <select id="kernel">
                <option value="0">Default (9-point)</option>
                <option value="1">Cross (4-point)</option>
                <option value="2">Diagonal (4-point)</option>
                <option value="3">Spiral (5x5 asymmetric)</option>
                <option value="4">Other</option>
            </select>
            <small class="param-hint">Pattern used to calculate diffusion from neighbors</small>
        </div>

        <div class="control-group">
            <label for="gradient-preset">Gradient Preset</label>
            <select id="gradient-preset">
                <option value="rainbow">Rainbow</option>
                <option value="sunset">Sunset Glow</option>
                <option value="ocean">Ocean Depths</option>
                <option value="fire">Inferno</option>
                <option value="neon">Neon Dreams</option>
                <option value="forest">Forest Twilight</option>
            </select>
            <small class="param-hint">Pre-made color schemes for visualization</small>
        </div>

        <div class="control-group">
            <label>Color Gradient</label>
            <div id="grapick-container" style="margin-top: 8px;"></div>
            <small class="param-hint">Custom gradient editor: drag handles or add new colors</small>
        </div>

        <div class="control-group">
            <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="emboss" style="width: auto; height: auto;" checked>
                3D Emboss Effect
            </label>
            <small class="param-hint">Adds depth by simulating lighting and shadows</small>
        </div>

        <div class="control-group">
            <label>
                Zoom: <span class="value-display" id="zoom-value">1.0x</span>
            </label>
            <input type="range" id="zoom" min="1.0" max="10" step="0.5" value="1.0">
            <small class="param-hint">Magnification level (use mouse wheel to adjust)</small>
        </div>

        <div class="control-group">
            <label>
                Pan X: <span class="value-display" id="pan-x-value">0.0</span>
            </label>
            <input type="range" id="pan-x" min="-1" max="1" step="0.01" value="0">
            <small class="param-hint">Horizontal view position (use A/D keys)</small>
        </div>

        <div class="control-group">
            <label>
                Pan Y: <span class="value-display" id="pan-y-value">0.0</span>
            </label>
            <input type="range" id="pan-y" min="-1" max="1" step="0.01" value="0">
            <small class="param-hint">Vertical view position (use W/S keys)</small>
        </div>

        <h2>Controls</h2>
        <div class="button-group">
            <button id="pause" class="secondary">Pause</button>
            <button id="reset" class="secondary">Reset</button>
        </div>

        <div class="button-group" style="margin-top: 8px;">
            <button id="clear" class="secondary">Clear</button>
        </div>

        <div class="button-group" style="margin-top: 8px;">
            <button id="random">üé≤ Seed</button>
        </div>
        </div>
        
        <div id="about-tab" class="tab-content about-content">
            <h2>Introduction</h2>
            <p>
                The Gray‚ÄìScott model is a reaction‚Äìdiffusion system used to look at how simple chemical interactions can generate
                complex patterns. It describes the evolution of two chemical species, <i>U</i> and <i>V</i>, diffusing across a surface while undergoing an autocatalytic reaction. 
                Unlike linear diffusion equations, which smooth out disturbances, the Gray‚ÄìScott system is highly nonlinear and can produce stable spots, stripes, waves, and
                other very interesting <a href="https://en.wikipedia.org/wiki/Turing_pattern#">Turing patterns</a>.
            </p>
            <p>
                Because of its non-linear nature, we must simulate the system numerically. Here, we simulate it on a 2D grid using 
                finite difference approximations for the diffusion terms
                and explicit time-stepping for the reactions. Almost like a cellular automaton, but instead of
                having discrete states, each cell holds continuous concentration values for chemicals <i>U</i> and <i>V</i>.
            </p>
            <hr>
            <h2>Reaction‚ÄìDiffusion Model</h2>
            <p>
                The Gray‚ÄìScott system models a simplified autocatalytic reaction:
                <br><br>
                <i>U + 2V ‚Üí 3V</i> (autocatalysis)<br>
                <i>V ‚Üí P</i> (decay)<br>
                <br>
                Here, <i>U</i> is fed into the system at a constant rate, while <i>V</i> is the reactant that autocatalytically converts <i>U</i> into more of itself. Because of
                these interactions and imbalances, small changes in the concentrations of <i>U</i> and <i>V</i> can grow and lead to complex patterns.
                <br>When diffusion is included and the system is treated as a continuous 2D medium, the concentrations
                <i>U(x,y,t)</i> and <i>V(x,y,t)</i>&mdash;meaning 'the concentration of U or V at position (<i>x,y</i>) and time <i>t</i>'&mdash;evolve according to the following pair of partial differential equations:
                <div>
                    $$
                    \frac{\partial U}{\partial t}
                    = D_U \nabla^2 U - UV^2 + F(1 - U)
                    $$
                </div>
                
                <div>
                    $$
                    \frac{\partial V}{\partial t}
                    = D_V \nabla^2 V + UV^2 - (F + k)V
                    $$
                </div>
                , where <i>D<sub>U</sub></i> and <i>D<sub>V</sub></i> are the diffusion rates of species <i>U</i> and <i>V</i>, <i>F</i> is the feed rate of <i>U</i>; and <i>k</i> is the kill rate of <i>V</i>.
                \(\nabla^2\) is the Laplacian operator, which captures how the concentration at a point differs from its neighbors, which is how we derive diffusion.
            </p>
            <p>
                The first term, \(\ D_\_ \nabla^2 U \ \), is what represents our diffusion, and is what causes the chemicals to spread out over time.
                
                The second term, \(\ \pm UV^2 \ \), represents the autocatalytic reaction where species <i>U</i> is consumed to produce more of species <i>V</i>. 

                The third term in each equation represents the feed and removal rate of chemicals from the system. This maintains a non-equilibrium state, which is necessary for forming those interesting patterns.
            </p>
            <h2>Numerical Integration</h2>
            <p>Because the system has no closed-form solution, we approximate the PDEs to simulate the reaction-diffusion process over discrete time steps.
                We represent the 2D surface as a grid of cells, where each cell holds the 
                information about the concentrations of <i>U</i> and <i>V</i> present at that location. The Laplacian operator \(\ \nabla^2\ \) is approximated using a finite difference stencil.
                This simulation uses a 9-point stencil for better accuracy, but other stencils (like 4-point cross or even a diagonal) can also be used.
            </p>
            <p>
                To evolve the system in time, we step time by a small increment via the forward Euler method:
                <div style="font-size: 12px;">
                \[
                    U^{t+\Delta t}_{i,j} = U^t_{i,j} + \Delta t \left( D_U \nabla^2 U^t_{i,j} - U^t_{i,j} (V^t_{i,j})^2 + F(1 - U^t_{i,j}) \right)
                \]
                \[
                    V^{t+\Delta t}_{i,j} = V^t_{i,j} + \Delta t \left( D_V \nabla^2 V^t_{i,j} + U^t_{i,j} (V^t_{i,j})^2 - (F + k) V^t_{i,j} \right)
                \]
                </div>

                Or, in regular people terms, we compute the new concentration of <i>U</i> and <i>V</i> at each grid cell (<i>i,j</i>) by taking the current concentration, 
                adding the effects of diffusion (via the Laplacian), the reaction term, and the feed/kill terms, and then just scale it up by a small time step \(\ \Delta t\ \) for every 
                iteration.
                Because each grid point depends only on its immediate neighbors, the computation is highly parallelizable.
                Therefore, this simulation uses GPU acceleration via WebGPU compute shaders to efficiently compute the updates for all grid cells simultaneously. Neat!
            </p>
        </div>
    </div>
    <div id="status">Initializing...</div>

    <script src="https://unpkg.com/grapick"></script>
    <script type="module" src="index.js"></script>
</body>
<script src="https://cdn.jsdelivr.net/gh/MarketingPipeline/Markdown-Tag/markdown-tag-GitHub.js"></script>
</html>
